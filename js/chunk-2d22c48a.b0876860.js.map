{"version":3,"sources":["webpack:///./src/views/Coupons.vue","webpack:///./src/components/CouponModal.vue","webpack:///./src/components/CouponModal.vue?80f5","webpack:///./src/views/Coupons.vue?7700"],"names":["class","colspan","type","openModal","coupons","length","item","key","id","title","percent","dateFormat","due_date","is_enabled","deleteCoupons","pagination","getCoupons","ref","coupon","tempCoupon","status","couponModalStatus","tabindex","role","aria-labelledby","aria-hidden","data-bs-dismiss","aria-label","for","modalStatus","placeholder","code","min","true-value","false-value","submitCoupon","props","Object","default","String","required","data","modal","watch","this","Math","floor","Date","methods","show","closeModal","hide","newCoupon","editCoupon","api","$http","post","then","res","success","alert","message","$emit","catch","err","console","log","put","mounted","$refs","render","components","CouponModal","Pagination","inject","page","get","getTime","couponModal","delete","created"],"mappings":"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","file":"js/chunk-2d22c48a.b0876860.js","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <section class=\"topic\">\r\n      <h2>優惠券</h2>\r\n      <div class=\"text-end mt-4\">\r\n        <button type=\"button\" class=\"btn btn-primary\"\r\n            @click=\"openModal('isNew')\"\r\n        >\r\n          建立新的優惠券\r\n        </button>\r\n      </div>\r\n      <table class=\"table mt-4\">\r\n        <thead>\r\n          <tr>\r\n            <th>名稱</th>\r\n            <th>折扣百分比</th>\r\n            <th>到期日</th>\r\n            <th>是否啟用</th>\r\n            <th>編輯</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-if=\"coupons.length === 0\" class=\"noProduct\">\r\n            <td colspan=\"5\">未有優惠劵</td>\r\n          </tr>\r\n          <template v-else>\r\n            <tr v-for=\"item in coupons\" :key=\"item.id\">\r\n              <td>{{ item.title }}</td>\r\n              <td>{{ item.percent }}%</td>\r\n              <td>{{ `${dateFormat(item.due_date)}` }}</td>\r\n              <td>\r\n                <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\r\n                <span v-else class=\"text-muted\">未啟用</span>\r\n              </td>\r\n              <td>\r\n                <div class=\"btn-group\">\r\n                  <button type=\"button\" class=\"btn btn-outline-primary btn-sm\"\r\n                          @click=\"openModal ('edit', item)\"\r\n                  >\r\n                    編輯\r\n                  </button>\r\n                  <button type=\"button\" class=\"btn btn-outline-danger btn-sm\"\r\n                          @click=\"deleteCoupons(item.id)\"\r\n                  >\r\n                    刪除\r\n                  </button>\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          </template>\r\n        </tbody>\r\n      </table>\r\n    </section>\r\n    <div class=\"d-flex justify-content-center\">\r\n        <Pagination :pagination=\"pagination\" @page=\"getCoupons\"></Pagination>\r\n    </div>\r\n  </div>\r\n  <CouponModal\r\n        ref=\"couponModal\"\r\n        :coupon=\"tempCoupon\"\r\n        :status=\"couponModalStatus\"\r\n        @newCoupon=\"getCoupons\"\r\n        @editCoupon=\"getCoupons\"\r\n  >\r\n  </CouponModal>\r\n</template>\r\n\r\n<script>\r\nimport CouponModal from '../components/CouponModal.vue'\r\nimport Pagination from '../components/Pagination.vue'\r\nexport default {\r\n  components: {\r\n    CouponModal,\r\n    Pagination\r\n  },\r\n  inject: ['dateFormat'],\r\n  data () {\r\n    return {\r\n      coupons: [],\r\n      couponModalStatus: '',\r\n      tempCoupon: {},\r\n      pagination: {}\r\n    }\r\n  },\r\n  methods: {\r\n    // 取得優惠劵\r\n    getCoupons (page = 1) {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons?page=${page}`\r\n      this.$http\r\n        .get(api)\r\n        .then(res => {\r\n          // console.log(res)\r\n          if (res.data.success) {\r\n            this.coupons = res.data.coupons\r\n            this.pagination = res.data.pagination\r\n          } else {\r\n            alert('請重新載入')\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    // 開啟優惠卷Modal\r\n    openModal (status, coupon) {\r\n      if (status === 'isNew') {\r\n        this.tempCoupon = {\r\n          due_date: new Date().getTime() / 1000\r\n        }\r\n      } else if (status === 'edit') {\r\n        this.tempCoupon = { ...coupon }\r\n      }\r\n      this.couponModalStatus = status\r\n      this.$refs.couponModal.openModal()\r\n    },\r\n    // 刪除優惠劵\r\n    deleteCoupons (id) {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${id}`\r\n      this.$http.delete(api).then((res) => {\r\n        // console.log(res)\r\n        if (res.data.success) {\r\n          alert(res.data.message)\r\n          this.getCoupons()\r\n        } else {\r\n          alert(res.data.message)\r\n        }\r\n      }).catch((err) => {\r\n        console.log(err)\r\n      })\r\n    }\r\n  },\r\n  created () {\r\n    this.getCoupons()\r\n  }\r\n}\r\n</script>\r\n","<template>\r\n  <div\r\n    class=\"modal fade\"\r\n    id=\"couponModal\"\r\n    tabindex=\"-1\"\r\n    role=\"dialog\"\r\n    aria-labelledby=\"exampleModalLabel\"\r\n    aria-hidden=\"true\"\r\n    ref=\"modal\"\r\n  >\r\n    <div class=\"modal-dialog\" role=\"document\">\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-header\">\r\n          <h5 class=\"modal-title\" id=\"exampleModalLabel\">\r\n            <span v-if=\"modalStatus === 'isNew'\">新增優惠卷</span>\r\n            <span v-else>編輯優惠卷</span>\r\n          </h5>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn-close\"\r\n            data-bs-dismiss=\"modal\"\r\n            aria-label=\"Close\"\r\n          ></button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <div class=\"mb-3\">\r\n            <label for=\"title\">標題</label>\r\n            <input\r\n              type=\"text\"\r\n              class=\"form-control\"\r\n              id=\"title\"\r\n              placeholder=\"請輸入標題\"\r\n              v-model=\"tempCoupon.title\"\r\n            />\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <label for=\"coupon_code\">優惠碼</label>\r\n            <input\r\n              type=\"text\"\r\n              class=\"form-control\"\r\n              id=\"coupon_code\"\r\n              placeholder=\"請輸入優惠碼\"\r\n              v-model=\"tempCoupon.code\"\r\n            />\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <label for=\"due_date\">到期日</label>\r\n            <input\r\n              type=\"date\"\r\n              class=\"form-control\"\r\n              id=\"due_date\"\r\n              v-model=\"due_date\"\r\n            />\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <label for=\"price\">折扣百分比</label>\r\n            <input\r\n              type=\"number\"\r\n              class=\"form-control\"\r\n              id=\"price\"\r\n              min=\"0\"\r\n              placeholder=\"請輸入折扣百分比\"\r\n              v-model.number=\"tempCoupon.percent\"\r\n            />\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <div class=\"form-check\">\r\n              <input\r\n                class=\"form-check-input\"\r\n                type=\"checkbox\"\r\n                :true-value=\"1\"\r\n                :false-value=\"0\"\r\n                id=\"is_enabled\"\r\n                v-model=\"tempCoupon.is_enabled\"\r\n              />\r\n              <label class=\"form-check-label\" for=\"is_enabled\">\r\n                是否啟用\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-secondary\"\r\n            data-bs-dismiss=\"modal\"\r\n          >\r\n            Close\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-primary\"\r\n            v-if=\"modalStatus === 'isNew'\"\r\n            @click=\"submitCoupon(tempCoupon.id)\"\r\n          >\r\n            新增優惠券\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn btn-primary\"\r\n            v-else\r\n            @click=\"submitCoupon(tempCoupon.id)\"\r\n          >\r\n            更新優惠券\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Modal from 'bootstrap/js/dist/modal'\r\nexport default {\r\n  props: {\r\n    coupon: {\r\n      type: Object,\r\n      default () {\r\n        return {}\r\n      }\r\n    },\r\n    status: {\r\n      type: String,\r\n      required: true\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      modal: '',\r\n      modalStatus: '',\r\n      tempCoupon: {},\r\n      due_date: ''\r\n    }\r\n  },\r\n  watch: {\r\n    coupon () {\r\n      this.tempCoupon = this.coupon\r\n    },\r\n    due_date () {\r\n      this.tempCoupon.due_date = Math.floor(new Date(this.due_date) / 1000)\r\n    },\r\n    status () {\r\n      this.modalStatus = this.status\r\n    }\r\n  },\r\n  methods: {\r\n    // 開啟 Modal\r\n    openModal () {\r\n      this.modal.show()\r\n    },\r\n    // 關閉 Modal\r\n    closeModal () {\r\n      this.modal.hide()\r\n    },\r\n    // 判斷送出行為\r\n    submitCoupon (id) {\r\n      if (this.modalStatus === 'isNew') {\r\n        this.newCoupon()\r\n      } else if (this.modalStatus === 'edit') {\r\n        this.editCoupon(id)\r\n      }\r\n    },\r\n    // 新增 Coupon\r\n    newCoupon () {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\r\n      this.$http.post(api, { data: this.tempCoupon }).then((res) => {\r\n        // console.log(res)\r\n        if (res.data.success) {\r\n          alert(res.data.message)\r\n          this.$emit('newCoupon')\r\n          this.closeModal()\r\n          this.tempCoupon = {}\r\n        } else {\r\n          alert(res.data.message)\r\n        }\r\n      }).catch((err) => {\r\n        console.log(err)\r\n      })\r\n    },\r\n    // 修改 Coupon\r\n    editCoupon (id) {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${id}`\r\n      this.$http.put(api, { data: this.tempCoupon }).then((res) => {\r\n        console.log(res)\r\n        if (res.data.success) {\r\n          alert(res.data.message)\r\n          this.closeModal()\r\n          this.$emit('editCoupon')\r\n        } else {\r\n          alert(res.data.message)\r\n        }\r\n      }).catch((err) => {\r\n        console.log(err)\r\n      })\r\n    }\r\n  },\r\n  mounted () {\r\n    this.modal = new Modal(this.$refs.modal)\r\n  }\r\n}\r\n</script>\r\n","import { render } from \"./CouponModal.vue?vue&type=template&id=fd33e4aa\"\nimport script from \"./CouponModal.vue?vue&type=script&lang=js\"\nexport * from \"./CouponModal.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./Coupons.vue?vue&type=template&id=4e1cdca1\"\nimport script from \"./Coupons.vue?vue&type=script&lang=js\"\nexport * from \"./Coupons.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}